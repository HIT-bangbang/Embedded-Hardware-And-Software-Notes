# 仿真步长

仿真步长是针对于整个系统的求解器而言的，步长越小，求解越准，仿真越精确。

仿真步长只是设置了求解器的性质，比如系统在时域上积分的精度，毕竟仿真所有的计算都是数值解，而不是精确解，肯定设计到数值积分或者迭代，所以迭代的步长，或者积分约精细，求解的越准确。

定步长仿真：求解器按照固定步长来进行仿真，这个步长可以根据系统的精度来进行设置。步长越小，精度越高，采样步长就越多，仿真一次需要的时间就越长。

变步长模式：可以在仿真的过程中改变步长，提供误差控制和过零检测，变步长系统Matlab会不断迭代缩小步长，直到结果满足误差要求为止，具体的采样点的个数有误差精度来决定。


# 采样时间

采样时间指的是 **“模块的采样时间”**

既然是模块的采样时间，那么该系统一定是个离散系统。采样是数据更新的时间，控制的核心是反馈，控制器需要系统的输出才能给出下一步的控制指令，但是系统输出是一个连续信号，但是我们需要的是一个离散信号，因此在测量时就涉及到采样频率，也就是我多久测量一次系统的输出。同样以上述电机为例，这个采样时间可以理解为电机三相相电流的采样周期。值得注意的是，采样周期要小于控制周期，这样才能保证系统稳定运行。


许多模块，一般会有一个采样时间，用于设值该模块产生的信号被采样的时候的更新速度

例如

正弦波模块设置为 0 意味着连续采样

常值信号设置为 inf 意味着不需要更新

# powergui采样时间
如果系统如果用到了电气元件（powerlib中的模块），就需要在仿真中加入Powergui模块。powergui只影响仿真中的电气元件的仿真步长，以及采样时间等（例如电压表、电流表），而不影响其余非电气的模块。

当你的系统如果用到了电气元件，就需要在仿真中配置Powergui模块。powergui的采样时间，指的是整个电气模型的数据更新时间长短，具体来说指的是电气信号的采样时间，比如电源。powergui的采样时间越短，则说明Simulink描述电气模型描述的越准确。同时powergui的设置是不影响非电气信号的。两个或两个以上的采样时间设置，若同时作用在同一个模块上，以最大的为准。

可以把所有的电气元件看做一个大模块，并设置了一个统一的模块采样时间

# 控制周期

这个问题在搭建控制系统模型仿真中会遇到，模拟负责控制的单片机发指令，隔一段时间发一次指令，因此就有了控制周期，也可以用控制频率表示。表示完成一次控制所需要的时间，比如对于电机的FOC控制来说，电机的控制周期就是进行一次矢量控制的时间，即控制周期等于开关管的开关频率。

（Matlab Function）也会有采样时间，这个采样时间其实是该模块的**控制周期**，也就是多长时间进行一次运算


# 优先级

多个不同的采样时间同时作用于一个模块，以时间最大的为准（可以这么理解，实际上更复杂，详细见Matlab官方文档）


# 时间设置

## 采样时间
1. sample time = -1,表示继承输入信号的采样时间，若没有输入信号，继承父层模型采样时间；如果模块无输入信号且本身处于顶层模型中，则继承系统解算器的步长。

2. sample time = 0，表示连续采样。

3. sample time = 非零正数，表示离散采样时间，例如0.01意思是我们输入的信号采样周期是0.01秒。

4.sample time = Inf,无穷大采样时间，即不采样，即常数模块。

5.还可以在sample time这一栏填入一个包含两个元素的数组`[sampletime,offset]`。例如填入`[0.2,0.01]`，此时表示采样周期是0.2秒，但是不是从零时刻开始采样的，而是从0.01秒处开始采样的，即采样时间点为：0.01，0.21，0.41等等。

一般情况下sample time =-1


## 时间关系

一般来说，步长<采样周期<控制周期 且最好是整数倍关系

如果求解器是定步长，各个模块的采样周期也必须是求解器步长的整数倍